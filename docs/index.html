$index = @'
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Monthly Regulatory Update</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="assets/style.css" />
</head>

<body>
  <header>
    <h1>Monthly Regulatory Update</h1>
    <div class="subtitle">Prior-month regulatory intelligence, published monthly.</div>

    <div class="header-meta">
      <div id="window" class="window">Window: (loading)</div>
      <div id="count" class="window">Items: (loading)</div>
    </div>

    <div class="nav">
      <a href="raw/" target="_blank" rel="noopener">Static Export</a>
      <a href="raw/items.md" target="_blank" rel="noopener">items.md</a>
      <a href="raw/items.txt" target="_blank" rel="noopener">items.txt</a>
      <a href="raw/items.ndjson" target="_blank" rel="noopener">items.ndjson</a>
      <a href="print/items.html" target="_blank" rel="noopener">print</a>
    </div>
  </header>

  <main>
    <div id="loading">Loading monthly items…</div>

    <section class="tiles" id="tiles"></section>
  </main>

  <footer>
    <hr />
    <p class="disclaimer">
      This dashboard summarizes public sources for convenience. Always refer to the official source for final language.
    </p>
  </footer>

<script>
(function () {
  const TILE_ORDER = [
    "OFAC","IRS","Payments","Banking","Mortgage","USDA",
    "Legislative","Executive",
    "Fintech Watch","Payment Card Networks","IS"
  ];

  // Accent colors per tile (left stripe)
  const TILE_ACCENT = {
    "OFAC": "#ef4444",
    "IRS": "#f59e0b",
    "Payments": "#2563eb",
    "Banking": "#0ea5e9",
    "Mortgage": "#22c55e",
    "USDA": "#16a34a",
    "Legislative": "#a855f7",
    "Executive": "#f97316",
    "Fintech Watch": "#06b6d4",
    "Payment Card Networks": "#111827",
    "IS": "#64748b",
  };

  const TILE_SOURCES = {
    "OFAC": [
      ["OFAC Recent Actions","https://ofac.treasury.gov/recent-actions"]
    ],
    "IRS": [
      ["IRS Newsroom","https://www.irs.gov/newsroom"]
    ],
    "Payments": [
      ["NACHA","https://www.nacha.org/"],
      ["Federal Reserve","https://www.federalreserve.gov/"]
    ],
    "Banking": [
      ["OCC","https://www.occ.gov/"],
      ["FDIC","https://www.fdic.gov/"]
    ],
    "Mortgage": [
      ["FHLB MPF","https://www.fhlbmpf.com/"],
      ["Fannie Mae","https://www.fanniemae.com/"],
      ["Freddie Mac","https://www.freddiemac.com/"]
    ],
    "USDA": [
      ["USDA Rural Development","https://www.rd.usda.gov/"]
    ],
    "Legislative": [
      ["Senate Banking Newsroom","https://www.banking.senate.gov/newsroom"],
      ["Federal Register","https://www.federalregister.gov/"]
    ],
    "Executive": [
      ["White House News","https://www.whitehouse.gov/news/"]
    ],
    "Fintech Watch": [
      ["FIS","https://investor.fisglobal.com/press-releases"],
      ["Fiserv","https://investors.fiserv.com/newsroom/news-releases"],
      ["Jack Henry","https://ir.jackhenry.com/press-releases"]
    ],
    "Payment Card Networks": [
      ["Visa","https://usa.visa.com/about-visa/newsroom.html"],
      ["Mastercard","https://www.mastercard.com/us/en/news-and-trends/press.html"]
    ],
    "IS": [
      ["BleepingComputer","https://www.bleepingcomputer.com/"],
      ["Microsoft MSRC","https://api.msrc.microsoft.com/"]
    ],
  };

  function esc(s) {
    return String(s ?? "")
      .replaceAll("&","&amp;").replaceAll("<","&lt;")
      .replaceAll(">","&gt;").replaceAll('"',"&quot;")
      .replaceAll("'","&#39;");
  }

  function fmtDate(iso) {
    if (!iso) return "";
    // show YYYY-MM-DD only
    return String(iso).slice(0,10);
  }

  function tileTemplate(cat) {
    const accent = TILE_ACCENT[cat] || "#2563eb";
    return `
      <section class="tile" data-cat="${esc(cat)}" style="--accent:${esc(accent)}">
        <div class="tile-head">
          <h2>${esc(cat)}</h2>
        </div>
        <div class="tile-body">
          <ul class="items" id="list-${esc(cat)}"></ul>
          <div class="empty" id="empty-${esc(cat)}" style="display:none;">No items for this month.</div>
        </div>
        <div class="tile-foot" id="foot-${esc(cat)}"></div>
      </section>
    `;
  }

  function renderSources(cat) {
    const srcs = TILE_SOURCES[cat] || [];
    if (!srcs.length) return "";
    const links = srcs.map(([label,url]) => `<a href="${esc(url)}" target="_blank" rel="noopener">${esc(label)}</a>`).join(" · ");
    return `Sources: ${links}`;
  }

  async function run() {
    const tilesEl = document.getElementById("tiles");
    const loadingEl = document.getElementById("loading");

    tilesEl.innerHTML = TILE_ORDER.map(tileTemplate).join("");

    // Set footers
    for (const cat of TILE_ORDER) {
      const f = document.getElementById(`foot-${cat}`);
      if (f) f.innerHTML = renderSources(cat);
    }

    let payload;
    try {
      const res = await fetch("data/items.json", { cache: "no-store" });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      payload = await res.json();
    } catch (e) {
      loadingEl.textContent = "Missing data/items.json (run build.py / workflow).";
      return;
    }

    const items = Array.isArray(payload.items) ? payload.items : [];

    // header meta
    const ws = payload.window_start || "";
    const we = payload.window_end || "";
    const gen = payload.generated_at_ct || payload.generated_at_utc || "";
    document.getElementById("window").innerHTML = `Window: <code>${esc(ws)}</code> → <code>${esc(we)}</code> (UTC)`;
    document.getElementById("count").innerHTML = `Items: <code>${items.length}</code> · Updated: <code>${esc(gen)}</code>`;

    // group by category
    const byCat = {};
    for (const it of items) {
      const c = it.category || "Other";
      (byCat[c] ||= []).push(it);
    }

    // sort within category (newest first)
    for (const c in byCat) {
      byCat[c].sort((a,b) => String(b.published_at||"").localeCompare(String(a.published_at||"")));
    }

    // render lists (show up to 25 per tile; adjust if you want)
    const MAX_PER_TILE = 25;

    for (const cat of TILE_ORDER) {
      const list = document.getElementById(`list-${cat}`);
      const empty = document.getElementById(`empty-${cat}`);
      if (!list || !empty) continue;

      const arr = byCat[cat] || [];
      if (!arr.length) {
        empty.style.display = "block";
        continue;
      }

      empty.style.display = "none";
      list.innerHTML = arr.slice(0, MAX_PER_TILE).map(it => `
        <li>
          <div class="headline">
            <a href="${esc(it.url)}" target="_blank" rel="noopener">${esc(it.title)}</a>
            <span class="date">${esc(fmtDate(it.published_at))}</span>
          </div>
          <div class="summary">
            <span class="source">[${esc(it.source)}]</span>
            ${it.summary ? esc(it.summary) : ""}
          </div>
        </li>
      `).join("");
    }

    loadingEl.style.display = "none";
  }

  run();
})();
</script>
</body>
</html>
'@

Set-Content -Path .\docs\index.html -Value $index -Encoding utf8

git add .\docs\index.html
git commit -m "Upgrade homepage to tile UI + split Legislative/Executive"
git push
